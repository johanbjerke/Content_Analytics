<form>
  <label>Kill Chain Coverage</label>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <title>Kill Chain Overview</title>
      <single>
        <search>
          <query>| rest splunk_server=local count=0 /services/saved/searches
| search title="ESCU - *"
| fields *escu*
| spath input="action.escu.mappings" path=cis20{} output="cis"
| spath input="action.escu.mappings" path=mitre_attack{} output="mitre_attack_technique"
| spath input="action.escu.mappings" path=kill_chain_phases{} output="kill_chain_phase"
| rename action.escu.full_search_name AS search_name

| stats count by kill_chain_phase, search_name

| stats sum(count) by kill_chain_phase</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="height">170</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xf7bc38","0x65a637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">1</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <set token="form.kill_chain_phase">$trellis.split.kill_chain_phase$</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <input type="dropdown" token="kill_chain_phase">
        <label>Kill Chain Phase</label>
        <choice value="%">Any</choice>
        <fieldForLabel>kill_chain_phase</fieldForLabel>
        <fieldForValue>kill_chain_phase</fieldForValue>
        <search>
          <query>| rest splunk_server=local count=0 /services/saved/searches
| search title="ESCU - *"
| fields *escu*
| spath input="action.escu.mappings" path=cis20{} output="cis"
| spath input="action.escu.mappings" path=mitre_attack{} output="mitre_attack_technique"
| spath input="action.escu.mappings" path=kill_chain_phases{} output="kill_chain_phase"
| rename action.escu.full_search_name AS search_name

| stats count by kill_chain_phase, search_name

| stats sum(count) by kill_chain_phase</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <default>%</default>
        <initialValue>%</initialValue>
      </input>
      <input type="dropdown" token="search_name">
        <label>Has search</label>
        <choice value="1=1">Any</choice>
        <choice value="isnotnull(search_name)">Yes</choice>
        <choice value="isnull(search_name)">No</choice>
        <default>isnotnull(search_name)</default>
      </input>
      <table>
        <search>
          <query>| rest splunk_server=local count=0 /services/saved/searches
| search title="ESCU - *"
| fields *escu*
| spath input="action.escu.mappings" path=cis20{} output="cis"
| spath input="action.escu.mappings" path=mitre_attack{} output="mitre_attack_technique"
| spath input="action.escu.mappings" path=kill_chain_phases{} output="kill_chain_phase"
| rename action.escu.full_search_name AS search_name

| stats count by kill_chain_phase, search_name

| stats values(search_name) AS search_name, sum(count) as count by kill_chain_phase
| where like(kill_chain_phase,"$kill_chain_phase$") AND $search_name$
| fillnull count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
